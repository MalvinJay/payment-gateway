webpackJsonp([20],{SI3C:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("Dd8w"),n=s.n(a),i=s("NYxO"),o=s("Usg1"),l=s("Y+wi"),r=function(e,t){};r.getCreateView=function(e){var t={};return(t=e).is_sub_user=!1,t};var c=r,d=(s("PJh5"),s("2etn")),u=s("zvae"),m={name:"JobDetails",data:function(){return{test:!0,loading:!1,readonly:!0,updateLoading:!1,addLoading:!1,schedule:[],days:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],field:{},changedFields:{},deleteLoading:!1,page:1,ready:!1,exportLoading:!1,GET_BASE_URI:u.b}},mounted:function(){o.a.$emit("sideNavClick","jobs"),this.$store.dispatch("getJobRuns",{id:this.$route.params.id}),this.$store.dispatch("getCurrentJob",{id:this.$route.params.id})},methods:{clickRun:function(e,t,s){s.property&&this.$refs.run.toggleRowExpansion(e)},clickContact:function(e,t,s){s.property&&this.$router.push("/job-contacts/"+e.id)},fetchTransactions:function(){this.$store.dispatch("getCurrentJob",{id:this.$route.params.id})},deleteCustomer:function(e,t){var s=this;c.getCreateView(this.form);this.$store.dispatch("updateJob",{id:this.form.id,data:this.form}).then(function(){s.$message({message:"Job Updated Successfully",type:"success"}),s.$store.dispatch("getCurrentJob",{id:s.$route.params.id,cache:!1})}).catch(function(){s.$message({message:"Job Not Updated",type:"error"})})},addContactToJob:function(){},toggleReadonly:function(){this.readonly=!this.readonly},cancel:function(){this.readonly=!0},runJob:function(){var e=this;this.runLoading=!0,this.$store.dispatch("runJob",this.form.id).then(function(t){t.data.success?(e.$message({message:"Job Run Successfully",type:"success"}),e.runLoading=!1,o.a.$emit("tabNumber","3"),setTimeout(function(){e.$store.dispatch("getJobRuns",{id:e.$route.params.id}),e.$store.dispatch("getBalance")},5e3)):(e.$message({type:"error",message:t.data.response.message}),e.runLoading=!1)}).catch(function(t){e.runLoading=!1;var s=t.response;e.$message({message:s.data.error,type:"error"})})},deleteJobContact:function(e,t){var s=this;this.deleteLoading=!0,this.$store.dispatch("deleteJobContact",{id:t.id,job:this.$route.params.id}).then(function(e){e.data.success?(s.$message({message:"Contact Deleted Successfully",type:"success"}),s.deleteLoading=!1,s.$store.dispatch("getCurrentJob",{id:s.$route.params.id,cache:!1})):(s.$message({type:"error",message:e.data.response.message}),s.deleteLoading=!1)}).catch(function(e){s.deleteLoading=!1;e.response;s.$message({message:"Delete failed",type:"error"})})},onChange:function(e,t){var s=this;this.addLoading=!0;var a=this.$el.querySelector(".upload-contacts input[type='file']").files[0];this.$store.dispatch("sendToBucket",a).then(function(e){if(e){var t={Bucket:d.c,Key:s.file.key},a=l.a.addContactToJobQuery(t);s.$store.dispatch("createJobContact",{id:s.form.id,job:a}).then(function(e){e.data.success?(s.$message({type:"success",message:e.data.response.message}),s.$store.dispatch("getCurrentJob",{id:s.$route.params.id})):s.$message({type:"error",message:e.data.response.message}),s.addLoading=!1})}})},update:function(){var e=this;this.updateLoading=!0,this.form.schedule=this.form.scheduled?l.a.createJobQuery(this.form.schedule,this.schedule):"false";var t=l.a.createJobDetailsArray(this.form,["description","scheduled","schedule","retry_limit","active","test"]);this.$store.dispatch("updateJob",{id:this.form.id,data:t}).then(function(t){t.data.success?(e.$message({message:"Job Updated Successfully",type:"success"}),e.updateLoading=!1,e.$store.dispatch("getCurrentJob",{id:e.$route.params.id,cache:!1})):(e.$message({type:"error",message:t.data.response.message}),e.updateLoading=!1)}).catch(function(t){e.updateLoading=!1;t.response;e.$message({message:"Update failed. Please try again later",type:"error"})})},handleCurrentChange:function(e){this.$store.dispatch("getCurrentJobRuns",{page:e})},handleCurrentCustomerChange:function(e){this.page=e},submitExport:function(e){var t=this;this.$store.dispatch("submitJobReport",e).then(function(e){e.data.success?(t.ready=!0,t.$message({type:"success",message:e.data.response.message})):t.$message({type:"error",message:e.data.response.message}),t.exportLoading=!1}).catch(function(e){console.log("job error",e.response),t.exportLoading=!1;var s=e.response;t.$message({message:s.data,type:"error"})})}},computed:n()({},Object(i.b)({form:"currentJob",state:"currentJobState",runs:"currentRuns",totalRunsStore:"currentJobRuns",runState:"currentJobRunsState",file:"file",fileState:"fileState",pageSize:"pageSize",pageLoading:"pageLoading",link:"downloadLink",token:"token"}),{error:function(){return"ERROR"===this.state},loadingPage:function(){return"LOADING"===this.state},runLoading:function(){return"LOADING"===this.runState},header:function(){return"Job"},totalRuns:function(){return this.totalRunsStore.length},data:function(){this.form.currency;var e={owner:this.form.owner,name:this.form.description,"number of runs":this.form.number_of_runs,date:this.form.created_at,time:this.form.created_at,scheduled:this.form.scheduled};return this.form.scheduled&&(e.schedule=this.form.schedule),e},contacts:function(){return this.form.contacts.map(function(e){return e.name})},data2:function(){return{"retry limit":this.form.retry_limit?this.form.retry_limit:"-","last run":this.form.last_run?this.form.last_run:"No previous run","next run":this.form.next_run?this.form.next_run:"No run scheduled",active:!!this.form.active&&this.form.active,test:this.form.test}},hasNoData:function(){return void 0===this.form}})},p={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingPage,expression:"loadingPage"}],staticClass:"h-80"},[e.error?s("div",{staticClass:"center h-80"},[s("div",{staticClass:"center flex-column"},[s("p",{staticClass:"m-0 p-0"},[e._v("Unable to load this page")]),e._v(" "),s("el-button",{attrs:{icon:"sync icon",type:"text"},on:{click:function(t){return t.preventDefault(),e.fetchTransactions(t)}}},[e._v("Retry")])],1)]):s("div",[s("el-card",{staticClass:"card-0 position-relative"},[s("div",{staticClass:"flex flex-column p-20"},[s("div",{staticClass:"flex justify-content-between align-items-baseline mb-1"},[s("div",{staticClass:"flex align-items-baseline"},[s("p",{staticClass:"blue-text s-24 m-0 p-0 bold-600"},[e._v(e._s(e.form.description))])]),e._v(" "),s("div",[s("p",{staticClass:"text-uppercase s-12 bold-600 m-0 p-0"},[e._v(e._s(e.header))])])]),e._v(" "),s("div",[e.form.scheduled?e._e():s("el-button",{staticClass:"z-depth-button bold-600 s-13 open-sans mini-button b-0",attrs:{loading:e.runLoading,icon:"undo icon",size:"mini",plain:""},on:{click:e.runJob}},[e._v("Run Job")])],1)]),e._v(" "),s("div",{staticClass:"border-top px-20 py-10"},[s("div",{staticClass:"flex"},[s("div",[s("i",{staticClass:"check circle s-12 icon green"})]),e._v(" "),s("div",{staticClass:"flex flex-column ml-1"},[s("p",{staticClass:"light mb-1 s-13"},[e._v(e._s(e.header)+" was created")]),e._v(" "),s("p",{staticClass:"light mb-1 s-12 gray"},[e._v(e._s(e._f("moment")(e.form.created_at,"MMM Do, YYYY hh:mm A")))])])])])]),e._v(" "),s("el-card",{staticClass:"my-2"},[s("div",{staticClass:"flex justify-content-between",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"blue-text bold-600 s-16"},[e._v(e._s(e.header)+" details")]),e._v(" "),e.readonly?e._e():s("div",{staticClass:"flex justify-content-end"},[s("el-button",{staticClass:"z-depth-button bold-600 s-13 open-sans mini-button b-0",attrs:{size:"mini",plain:""},on:{click:e.cancel}},[e._v("Cancel")]),e._v(" "),s("el-button",{staticClass:"z-depth-button bold-600 s-13 open-sans mini-button b-0",attrs:{loading:e.updateLoading,size:"mini",type:"primary"},on:{click:e.update}},[e._v("Save")])],1)]),e._v(" "),s("div",[e.hasNoData?s("div",{staticClass:"center h-80"},[e._v("\n                    No Data\n                ")]):e._e(),e._v(" "),e.hasNoData?e._e():s("div",[s("div",{staticClass:"flex"},[s("div",{staticClass:"w-50"},e._l(e.data,function(t,a,n){return s("el-row",{key:n,staticClass:"mb-1"},[s("el-col",{attrs:{span:8}},[s("p",{staticClass:"m-0 text-capitalize menu-gray-text s-14"},[e._v(e._s(a))])]),e._v(" "),s("el-col",{attrs:{span:16}},[e.readonly?s("div",["time"===a?s("p",{},[e._v(e._s(e._f("moment")(t,"hh:mm a")))]):"date"===a?s("p",{},[e._v(e._s(e._f("moment")(t,"MMM Do, YYYY")))]):"scheduled"===a?s("el-switch",{staticClass:"w-50",attrs:{disabled:""},model:{value:e.form.scheduled,callback:function(t){e.$set(e.form,"scheduled",t)},expression:"form.scheduled"}}):s("p",{},[e._v(e._s(t))])],1):s("div",["number of runs"===a||"owner"===a?s("p",{},[e._v(e._s(t))]):"time"===a?s("p",{},[e._v(e._s(e._f("moment")(t,"hh:mm a")))]):"date"===a?s("p",{},[e._v(e._s(e._f("moment")(t,"MMM Do, YYYY")))]):"name"===a?s("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}}):"scheduled"===a?s("el-switch",{staticClass:"w-50",model:{value:e.form.scheduled,callback:function(t){e.$set(e.form,"scheduled",t)},expression:"form.scheduled"}}):"schedule"===a&&e.form.scheduled?s("div",[s("div",{staticClass:"mb-2"},[s("div",{staticClass:"flex align-items-center h-30"},[s("el-switch",{staticClass:"w-50",attrs:{"active-text":"Daily","active-value":"daily"},model:{value:e.form.schedule,callback:function(t){e.$set(e.form,"schedule",t)},expression:"form.schedule"}}),e._v(" "),s("el-switch",{staticClass:"w-50",attrs:{"active-text":"Weekly","active-value":"weekly"},model:{value:e.form.schedule,callback:function(t){e.$set(e.form,"schedule",t)},expression:"form.schedule"}})],1),e._v(" "),s("div",{staticClass:"flex align-items-center h-30 mt-2"},[s("el-switch",{staticClass:"w-50",attrs:{"active-text":"Monthly","active-value":"monthly"},model:{value:e.form.schedule,callback:function(t){e.$set(e.form,"schedule",t)},expression:"form.schedule"}}),e._v(" "),s("el-switch",{staticClass:"w-50",attrs:{"active-text":"BiMonthly","active-value":"bimonthly"},model:{value:e.form.schedule,callback:function(t){e.$set(e.form,"schedule",t)},expression:"form.schedule"}})],1),e._v(" "),s("div",{staticClass:"flex align-items-center h-30 mt-2"},[s("el-switch",{staticClass:"w-50",attrs:{"active-text":"Quarterly","active-value":"quarterly"},model:{value:e.form.schedule,callback:function(t){e.$set(e.form,"schedule",t)},expression:"form.schedule"}}),e._v(" "),s("el-switch",{staticClass:"w-50",attrs:{"active-text":"Yearly","active-value":"yearly"},model:{value:e.form.schedule,callback:function(t){e.$set(e.form,"schedule",t)},expression:"form.schedule"}})],1)]),e._v(" "),s("transition",{attrs:{name:"el-fade-in"}},["daily"===e.form.schedule?s("div",[s("p",{staticClass:"text-uppercase s-12"},[e._v("time of trasactions postings")]),e._v(" "),s("el-time-select",{attrs:{size:"mini","picker-options":{start:"08:30",step:"00:15",end:"18:30"},placeholder:"Select Time"},model:{value:e.schedule.time,callback:function(t){e.$set(e.schedule,"time",t)},expression:"schedule.time"}})],1):"weekly"===e.form.schedule?s("div",[s("p",{staticClass:"text-uppercase s-12"},[e._v("date & time of trasactions postings")]),e._v(" "),s("el-select",{staticClass:"w-50 mb-1",attrs:{placeholder:"Select Date",size:"mini"},model:{value:e.schedule.date,callback:function(t){e.$set(e.schedule,"date",t)},expression:"schedule.date"}},e._l(e.days,function(e,t){return s("el-option",{key:t,attrs:{label:e,value:e}})})),e._v(" "),s("el-time-select",{staticClass:"w-50",attrs:{size:"mini","picker-options":{start:"08:30",step:"00:15",end:"18:30"},placeholder:"Select Time"},model:{value:e.schedule.time,callback:function(t){e.$set(e.schedule,"time",t)},expression:"schedule.time"}})],1):s("div",[s("p",{staticClass:"text-uppercase s-12"},[e._v("date & time of trasactions postings")]),e._v(" "),s("el-date-picker",{staticClass:"w-50 mb-1",attrs:{size:"mini",type:"date",placeholder:"Select Date","value-format":"yyyy-MM-dd",format:"MMM dd, yyyy","default-value":Date.now()},model:{value:e.schedule.date,callback:function(t){e.$set(e.schedule,"date",t)},expression:"schedule.date"}}),e._v(" "),s("el-time-select",{staticClass:"w-50",attrs:{size:"mini","picker-options":{start:"08:30",step:"00:15",end:"18:30"},placeholder:"Select Time"},model:{value:e.schedule.time,callback:function(t){e.$set(e.schedule,"time",t)},expression:"schedule.time"}})],1)])],1):s("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini"},model:{value:e.form[a],callback:function(t){e.$set(e.form,a,t)},expression:"form[key]"}})],1)])],1)})),e._v(" "),s("div",{staticClass:"w-50"},e._l(e.data2,function(t,a,n){return s("el-row",{key:n,staticClass:"mb-1",attrs:{type:"flex",align:"middle"}},[s("el-col",{attrs:{span:8}},[s("p",{staticClass:"m-0 text-capitalize menu-gray-text s-14"},[e._v(e._s(a))])]),e._v(" "),s("el-col",{attrs:{span:16}},[e.readonly?s("div",["active"===a?s("el-switch",{attrs:{disabled:""},model:{value:e.data2[a],callback:function(t){e.$set(e.data2,a,t)},expression:"data2[key]"}}):"test"===a?s("el-switch",{attrs:{disabled:""},model:{value:e.data2[a],callback:function(t){e.$set(e.data2,a,t)},expression:"data2[key]"}}):s("p",{},[e._v(e._s(t))])],1):s("div",["last run"===a||"next run"===a?s("p",{},[e._v(e._s(e._f("moment")(t,"MMM Do, YYYY")))]):"active"===a?s("el-switch",{model:{value:e.form.active,callback:function(t){e.$set(e.form,"active",t)},expression:"form.active"}}):"test"===a?s("el-switch",{model:{value:e.form.test,callback:function(t){e.$set(e.form,"test",t)},expression:"form.test"}}):"retry limit"===a?s("el-input",{staticStyle:{width:"80%"},attrs:{size:"mini"},model:{value:e.form.retry_limit,callback:function(t){e.$set(e.form,"retry_limit",t)},expression:"form.retry_limit"}}):s("el-input-number",{staticClass:"text-left",staticStyle:{width:"80%"},attrs:{controls:!1,size:"mini"},model:{value:e.form[a],callback:function(t){e.$set(e.form,a,t)},expression:"form[key]"}})],1)])],1)}))])])])]),e._v(" "),s("el-card",{staticClass:"my-2 card-0"},[s("div",{attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"blue-text bold-600 s-16"},[e._v(e._s(e.header)+" runs")])]),e._v(" "),s("div",[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingPage,expression:"loadingPage"}],ref:"run",staticClass:"default-table-expanded",attrs:{"empty-text":"No job runs to display","row-class-name":"transactions-table-body","header-row-class-name":"transactions-table-header",data:e.runs},on:{"row-click":e.clickRun}},[s("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-table",{attrs:{"empty-text":"No transactions","tooltip-effect":"light","header-row-class-name":"transactions-table-header","row-class-name":"transactions-table-body",data:t.row.executed_transctions}},[s("el-table-column",{attrs:{prop:"receiver_name",label:"Name"}}),e._v(" "),s("el-table-column",{attrs:{prop:"receiver_no",label:"Number"}}),e._v(" "),s("el-table-column",{attrs:{prop:"reference",label:"Reference"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                        "+e._s(t.row.reference)+"\n                                    ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"sender_amount",label:"Amount"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                        "+e._s(e._f("money")(t.row.sender_amount))+"\n                                    ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"charged_amount",label:"Fee"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                                        "+e._s(e._f("money")(t.row.charged_amount))+"\n                                    ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"status",label:""},scopedSlots:e._u([{key:"default",fn:function(e){return[s("div",{staticClass:"flex"},[s("the-tag",{attrs:{status:"failed",title:e.row.status,icon:"reply icon"}})],1)]}}])})],1)]}}])}),e._v(" "),s("el-table-column",{attrs:{type:"index"}}),e._v(" "),s("el-table-column",{attrs:{prop:"date",label:"Date"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e._f("moment")(t.row.updated_at,"MMM Do, YYYY"))+"\n                        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"time",label:"Time"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e._f("moment")(t.row.updated_at,"hh:mm A"))+"\n                        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{"min-width":"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.ready?s("a",{staticClass:"cursor open-sans el-button el-button--primary el-button--mini",attrs:{href:e.GET_BASE_URI+"v1/clients/reports/download?access_token="+e.token+"&file_name="+e.link,target:"_blank",download:""}},[e._v("Download")]):s("el-button",{staticClass:"p-0 m-0",attrs:{loading:e.exportLoading,type:"text",icon:"download icon"},on:{click:function(s){e.submitExport(t.row.id)}}})]}}])})],1),e._v(" "),s("div",{staticClass:"flex justify-content-between align-items-center px-20"},[s("div",{staticClass:"s-12"},[e._v("\n                        "+e._s(e.runs.length)+" results\n                    ")]),e._v(" "),s("el-pagination",{staticClass:"my-2 flex justify-content-end",attrs:{"page-size":e.pageSize,layout:"prev, pager, next",total:e.totalRuns},on:{"current-change":e.handleCurrentChange}})],1)],1)]),e._v(" "),s("el-card",{staticClass:"my-2 card-0"},[s("div",{staticClass:"flex align-items-baseline justify-content-between",attrs:{slot:"header"},slot:"header"},[s("span",{staticClass:"blue-text bold-600 s-16"},[e._v("Subscribers")]),e._v(" "),s("el-upload",{staticClass:"upload-contacts no-show-upload",attrs:{action:"","on-change":e.onChange,"auto-upload":!1,accept:".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","file-list":e.form.fileList}},[s("el-button",{staticClass:"z-depth-button s-13 open-sans mini-button b-0",attrs:{loading:e.addLoading,type:"primary",size:"mini",icon:"plus icon"}},[e._v("Upload Contacts")])],1)],1),e._v(" "),s("div",{staticClass:"breathe"},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{"empty-text":"No job subscribers","row-class-name":"transactions-table-body","header-row-class-name":"transactions-table-header",data:e.form.contacts.slice(12*e.page-12,12*e.page)},on:{"row-click":e.clickContact}},[s("el-table-column",{attrs:{type:"index"}}),e._v(" "),s("el-table-column",{attrs:{prop:"name",label:"name"}}),e._v(" "),s("el-table-column",{attrs:{prop:"msisdn",label:"Phone Number"}}),e._v(" "),s("el-table-column",{attrs:{prop:"amount",label:"amount"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e._f("money")(t.row.amount))+"\n                        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"updated_at",label:"date"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(e._f("moment")(t.row.updated_at,"MMM Do, YYYY"))+"\n                        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{width:"80",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-button",{staticClass:"p-0 m-0",attrs:{loading:e.deleteLoading,icon:"trash alternate outline icon",type:"text"},nativeOn:{click:function(s){s.preventDefault(),e.deleteJobContact(t.$index,t.row)}}})]}}])})],1),e._v(" "),s("div",{staticClass:"flex justify-content-between align-items-center px-20"},[s("div",{staticClass:"s-12"},[e._v("\n                        "+e._s(e.form.contacts.slice(12*e.page-12,12*e.page).length)+" results\n                    ")]),e._v(" "),s("el-pagination",{staticClass:"my-2 flex justify-content-end",attrs:{"page-size":e.pageSize,layout:"prev, pager, next",total:e.totalRuns},on:{"current-change":e.handleCurrentCustomerChange}})],1)],1)])],1)])},staticRenderFns:[]};var f=s("VU/8")(m,p,!1,function(e){s("yyU9")},"data-v-234dd85e",null);t.default=f.exports},yyU9:function(e,t){}});
//# sourceMappingURL=20.cd8660c805333a14a113.js.map